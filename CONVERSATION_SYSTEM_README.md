# ูุธุงู ุงููุญุงุฏุซุงุช ุงููุชูุฏู - Masaar Backend

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ูุญุงุฏุซุงุช ุดุงูู ููุฑู ูุฏุนู ุฌููุน ุฃููุงุน ุงูุชูุงุตู ูู ุชุทุจูู Masaarุ ุจูุง ูู ุฐูู:
- ูุญุงุฏุซุงุช ุงููุณุชุฎุฏููู ูุน ุงูุฏุนู ุงูููู (Admin-User)
- ูุญุงุฏุซุงุช ุงููุณุชุฎุฏููู ูุน ููุฏูู ุงูุฎุฏูุงุช (User-Provider)
- ูุญุงุฏุซุงุช ุงููุณุชุฎุฏููู ูุน ุจุนุถูู ุงูุจุนุถ (User-User)

## ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### ๐ฅ ุงูููุฒุงุช ุงูุฃุณุงุณูุฉ
- โ ุฅุฑุณุงู ูุงุณุชูุจุงู ุงูุฑุณุงุฆู ุงููุตูุฉ
- โ ุฏุนู ุงูุตูุฑ ูุงููููุงุช
- โ ุฑุณุงุฆู ุงููุธุงู ุงูุชููุงุฆูุฉ
- โ ุญุงูุงุช ุงููุญุงุฏุซุฉ (ููุชูุญุฉุ ูุบููุฉุ ูุคุฑุดูุฉ)
- โ ุชุชุจุน ุญุงูุฉ ูุฑุงุกุฉ ุงูุฑุณุงุฆู
- โ ุงูุจุซ ุงููุจุงุดุฑ ููุฑุณุงุฆู (Real-time)

### ๐ ุงูููุฒุงุช ุงููุชูุฏูุฉ
- โ ูุคุดุฑุงุช ุงููุชุงุจุฉ (Typing Indicators)
- โ ุญุงูุฉ ุงููุณุชุฎุฏู (Online/Offline/Away)
- โ ุฅุดุนุงุฑุงุช ููุฑูุฉ (Push Notifications)
- โ ุฅุดุนุงุฑุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- โ ุชูุธูู ุงูุจูุงูุงุช ุงูุชููุงุฆู
- โ ุฅุญุตุงุฆูุงุช ุดุงููุฉ ูููุฏุฑุงุก

## ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู ุงููุญุงุฏุซุงุช (conversations)
```sql
- id: ูุนุฑู ุงููุญุงุฏุซุฉ
- user1_id: ุงููุณุชุฎุฏู ุงูุฃูู
- user2_id: ุงููุณุชุฎุฏู ุงูุซุงูู (ุงุฎุชูุงุฑู)
- admin_id: ูุนุฑู ุงููุฏูุฑ (ูููุญุงุฏุซุงุช ุงูุฅุฏุงุฑูุฉ)
- type: ููุน ุงููุญุงุฏุซุฉ (admin_user, user_provider, user_user)
- status: ุญุงูุฉ ุงููุญุงุฏุซุฉ (open, closed, archived)
- title: ุนููุงู ุงููุญุงุฏุซุฉ
- last_message_at: ููุช ุขุฎุฑ ุฑุณุงูุฉ
- metadata: ุจูุงูุงุช ุฅุถุงููุฉ (JSON)
- created_at, updated_at, deleted_at
```

### ุฌุฏูู ุงูุฑุณุงุฆู (messages)
```sql
- id: ูุนุฑู ุงูุฑุณุงูุฉ
- conversation_id: ูุนุฑู ุงููุญุงุฏุซุฉ
- sender_id: ูุนุฑู ุงููุฑุณู
- content: ูุญุชูู ุงูุฑุณุงูุฉ
- type: ููุน ุงูุฑุณุงูุฉ (text, image, file, system)
- is_read: ูู ุชู ูุฑุงุกุฉ ุงูุฑุณุงูุฉ
- read_at: ููุช ุงููุฑุงุกุฉ
- metadata: ุจูุงูุงุช ุฅุถุงููุฉ (JSON)
- created_at, updated_at, deleted_at
```

## API Endpoints

### ุงููุญุงุฏุซุงุช
```
GET    /api/conversations              # ูุงุฆูุฉ ุงููุญุงุฏุซุงุช
POST   /api/conversations              # ุฅูุดุงุก ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ
GET    /api/conversations/{id}         # ุชูุงุตูู ูุญุงุฏุซุฉ
PUT    /api/conversations/{id}/status  # ุชุญุฏูุซ ุญุงูุฉ ุงููุญุงุฏุซุฉ
DELETE /api/conversations/{id}         # ุฃุฑุดูุฉ ุงููุญุงุฏุซุฉ
POST   /api/conversations/{id}/mark-all-read # ุชุนููู ุฌููุน ุงูุฑุณุงุฆู ูููุฑูุกุฉ
```

### ุงูุฑุณุงุฆู
```
GET    /api/conversations/{id}/messages # ุฑุณุงุฆู ุงููุญุงุฏุซุฉ
POST   /api/conversations/{id}/messages # ุฅุฑุณุงู ุฑุณุงูุฉ ุฌุฏูุฏุฉ
PUT    /api/messages/{id}              # ุชุนุฏูู ุฑุณุงูุฉ
DELETE /api/messages/{id}              # ุญุฐู ุฑุณุงูุฉ
POST   /api/messages/{id}/mark-read    # ุชุนููู ุฑุณุงูุฉ ูููุฑูุกุฉ
```

### ุงูููุฒุงุช ุงููุชูุฏูุฉ
```
POST   /api/conversations/{id}/typing           # ุฅุดุนุงุฑ ุงููุชุงุจุฉ
GET    /api/conversations/{id}/typing-users     # ุงููุณุชุฎุฏููู ุงูุฐูู ููุชุจูู
GET    /api/conversations/{id}/participants-status # ุญุงูุฉ ุงููุดุงุฑููู
POST   /api/user/status                         # ุชุญุฏูุซ ุญุงูุฉ ุงููุณุชุฎุฏู
GET    /api/user/{id}/status                    # ุญุงูุฉ ูุณุชุฎุฏู ูุญุฏุฏ
POST   /api/user/heartbeat                      # ูุจุถุฉ ุงููุดุงุท
```

### ุงููุฏุฑุงุก
```
GET    /api/admin/conversations/statistics     # ุฅุญุตุงุฆูุงุช ุงููุญุงุฏุซุงุช
POST   /api/admin/conversations/{id}/system-message # ุฅุฑุณุงู ุฑุณุงูุฉ ูุธุงู
```

## ุงูุฃุญุฏุงุซ ูุงูุจุซ ุงููุจุงุดุฑ

### ุงูุฃุญุฏุงุซ ุงููุชุงุญุฉ
- `NewMessage`: ุฑุณุงูุฉ ุฌุฏูุฏุฉ
- `UserTyping`: ูุคุดุฑ ุงููุชุงุจุฉ
- `UserStatusChanged`: ุชุบููุฑ ุญุงูุฉ ุงููุณุชุฎุฏู

### ูููุงุช ุงูุจุซ
- `chat.{conversationId}`: ููุงุฉ ุงููุญุงุฏุซุฉ
- `user.{userId}`: ููุงุฉ ุงููุณุชุฎุฏู ุงูุดุฎุตูุฉ
- `admin.notifications`: ููุงุฉ ุฅุดุนุงุฑุงุช ุงููุฏุฑุงุก
- `system.announcements`: ููุงุฉ ุงูุฅุนูุงูุงุช ุงูุนุงูุฉ

## ุงูุชูููู

### ููู ุงูุชูููู: `config/conversation.php`
```php
// ุฃููุงุน ุงููุญุงุฏุซุงุช
'types' => [
    'admin_user' => ['features' => ['system_messages', 'email_notifications']],
    'user_provider' => ['features' => ['file_sharing', 'rating']],
    'user_user' => ['features' => ['basic_chat']]
],

// ุงูููุฒุงุช ุงููุชูุฏูุฉ
'features' => [
    'typing_indicators' => true,
    'user_status' => true,
    'message_reactions' => false,
    'auto_translation' => false
],

// ุงูุชูุธูู ุงูุชููุงุฆู
'cleanup' => [
    'enabled' => true,
    'soft_deleted_messages_days' => 30,
    'archived_conversations_days' => 90
]
```

## ุงูุฅุดุนุงุฑุงุช

### ุฃููุงุน ุงูุฅุดุนุงุฑุงุช
1. **ุฅุดุนุงุฑุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช**: ุชูุญูุธ ูู ุฌุฏูู `notifications`
2. **ุฅุดุนุงุฑุงุช FCM**: ููููุงุชู ุงููุญูููุฉ
3. **ุฅุดุนุงุฑุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู**: ูููุญุงุฏุซุงุช ุงููููุฉ

### ุชุฎุตูุต ุงูุฅุดุนุงุฑุงุช
```php
// ูู NewMessageNotification
public function shouldSend(object $notifiable, string $channel): bool
{
    // ููุทู ุชุญุฏูุฏ ูุชู ูุชู ุฅุฑุณุงู ุงูุฅุดุนุงุฑ
    return $this->customLogic($notifiable, $channel);
}
```

## ุงูุฃูุงู ูุงูุตูุงุญูุงุช

### Middleware ุงููุณุชุฎุฏูุฉ
- `auth:sanctum`: ุงูุชุญูู ูู ุงููููุฉ
- `conversation.participant`: ุงูุชุญูู ูู ุงููุดุงุฑูุฉ ูู ุงููุญุงุฏุซุฉ
- `is_admin`: ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุฏูุฑ

### ููุงุนุฏ ุงููุตูู
1. ุงููุณุชุฎุฏููู ูููููู ุงููุตูู ููุท ูููุญุงุฏุซุงุช ุงูุชู ูุดุงุฑููู ูููุง
2. ุงููุฏุฑุงุก ูููููู ุงููุตูู ูุฌููุน ุงููุญุงุฏุซุงุช
3. ููุฏูู ุงูุฎุฏูุงุช ูููููู ุงูุชูุงุตู ูุน ุงููุณุชุฎุฏููู ููุท

## ุงูุชุดุบูู ูุงูุตูุงูุฉ

### ุชุดุบูู ุงูููุงู ุงููุฌุฏููุฉ
```bash
# ุชูุธูู ุงูุจูุงูุงุช ุงููุฏููุฉ
php artisan conversation:cleanup

# ุชูุธูู ุชุฌุฑูุจู (ุจุฏูู ุญุฐู ูุนูู)
php artisan conversation:cleanup --dry-run

# ุชูุธูู ุฅุฌุจุงุฑู (ุจุฏูู ุชุฃููุฏ)
php artisan conversation:cleanup --force
```

### ูุฑุงูุจุฉ ุงูุฃุฏุงุก
```bash
# ูุฑุงูุจุฉ ุงูุทูุงุจูุฑ
php artisan queue:work

# ูุฑุงูุจุฉ ุงูุจุซ ุงููุจุงุดุฑ
php artisan websockets:serve
```

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ ูุญููููุง

1. **ุงูุฑุณุงุฆู ูุง ุชุตู ูู ุงูููุช ุงููุนูู**
   - ุชุฃูุฏ ูู ุชุดุบูู WebSocket server
   - ุชุญูู ูู ุฅุนุฏุงุฏุงุช Broadcasting ูู `.env`

2. **ุงูุฅุดุนุงุฑุงุช ูุง ุชูุฑุณู**
   - ุชุฃูุฏ ูู ุชุดุบูู Queue worker
   - ุชุญูู ูู ุฅุนุฏุงุฏุงุช FCM

3. **ูุดุงูู ุงูุตูุงุญูุงุช**
   - ุชุฃูุฏ ูู ุชุณุฌูู Middleware ุจุดูู ุตุญูุญ
   - ุชุญูู ูู ุงูุนูุงูุงุช ูู Models

### ุณุฌูุงุช ุงููุธุงู
```bash
# ุนุฑุถ ุณุฌูุงุช Laravel
tail -f storage/logs/laravel.log

# ุนุฑุถ ุณุฌูุงุช ุงููุญุงุฏุซุงุช
grep "conversation" storage/logs/laravel.log
```

## ุงูุชุทููุฑ ุงููุณุชูุจูู

### ููุฒุงุช ููุชุฑุญุฉ
- [ ] ุฑุฏูุฏ ุงูุฃูุนุงู ุนูู ุงูุฑุณุงุฆู (Reactions)
- [ ] ุฅุนุงุฏุฉ ุชูุฌูู ุงูุฑุณุงุฆู
- [ ] ุงูุจุญุซ ูู ุงููุญุงุฏุซุงุช
- [ ] ุงูุชุฑุฌูุฉ ุงูุชููุงุฆูุฉ
- [ ] ุงูููุงููุงุช ุงูุตูุชูุฉ/ุงููุฑุฆูุฉ
- [ ] ูุดุงุฑูุฉ ุงููููุน
- [ ] ุงูุฑุณุงุฆู ุงููุฌุฏููุฉ

### ุชุญุณููุงุช ุงูุฃุฏุงุก
- [ ] ุชุฎุฒูู ูุคูุช ูููุญุงุฏุซุงุช ุงููุดุทุฉ
- [ ] ุถุบุท ุงูุฑุณุงุฆู ุงููุฏููุฉ
- [ ] ููุฑุณุฉ ูุญุณูุฉ ููุงุนุฏุฉ ุงูุจูุงูุงุช
- [ ] ุชุญุณูู ุงุณุชุนูุงูุงุช ุงูุจุญุซ

## ุงููุณุงููุฉ

ุนูุฏ ุฅุถุงูุฉ ููุฒุงุช ุฌุฏูุฏุฉ:
1. ุงุชุจุน ูุนุงููุฑ ุงูููุฏ ุงูููุฌูุฏุฉ
2. ุฃุถู ุงุฎุชุจุงุฑุงุช ููููุฒุงุช ุงูุฌุฏูุฏุฉ
3. ุญุฏุซ ุงูุชูุซูู
4. ุชุฃูุฏ ูู ุงูุชูุงูู ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ

## ุงูุฏุนู

ููุญุตูู ุนูู ุงููุณุงุนุฏุฉ:
- ุฑุงุฌุน ุณุฌูุงุช ุงููุธุงู ุฃููุงู
- ุชุญูู ูู ุฅุนุฏุงุฏุงุช ุงูุชูููู
- ุงุณุชุฎุฏู ุฃุฏูุงุช ุงูุชุดุฎูุต ุงููุชุงุญุฉ

---

**ุชู ุชุทููุฑ ูุฐุง ุงููุธุงู ุจูุงุณุทุฉ ูุฑูู Masaar Development Team**

*ุขุฎุฑ ุชุญุฏูุซ: ููุงูุฑ 2024*